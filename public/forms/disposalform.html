<!DOCTYPE html>
<html lang="en">


<head>
     
  <meta charset="UTF-8">
      <title>Disposal Form Review - HOD</title>
      <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
      background: #f9f9f9;
    }


    h2 {
      text-align: center;
      margin-bottom: 20px;
    }


    .section {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }


    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }


    input[type="text"],
    input[type="date"],
    input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      font-size: 1rem;
    }


    .signature-preview {
      margin-top: 10px;
      border: 1px dashed #aaa;
      height: 60px;
      text-align: center;
      line-height: 60px;
    }


    button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      background: green;
      color: #fff;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>


<body>
      <h2>Format for Disposal of Email Account</h2>


      <div class="section" id="employeeSection">
            <label>Unit Name:</label>
            <input type="text" id="unitName" readonly>


            <label>Department:</label>
            <input type="text" id="department" readonly>


            <label>Email Id of (Mr./Ms./Mrs.):</label>
            <input type="text" id="emailFrom" readonly>


            <label>Designation:</label>
            <input type="text" id="designationFrom" readonly>


            <label>Employee No.:</label>
            <input type="text" id="empNoFrom" readonly>


            <label>Transferred to Email Id of:</label>
            <input type="text" id="emailTo" readonly>


            <label>Designation:</label>
            <input type="text" id="designationTo" readonly>


            <label>Employee No.:</label>
            <input type="text" id="empNoTo" readonly>


            <label>Transfer Date:</label>
            <input type="date" id="transferDate" readonly>


            <label>Email ID to be Disposed:</label>
            <input type="text" id="disposableEmail" readonly>
        </div>


      <div class="section" id="hodSection">
            <h3>HOD Approval Section</h3>


            <label for="hodName">Name of HOD:</label>
            <input type="text" id="hodName">


            <label for="hodEmpNo">Employee No.:</label>
            <input type="text" id="hodEmpNo">


            <label for="hodEmail">Email Id:</label>
            <input type="text" id="hodEmail">


            <label>Signature:</label>
            <input type="file" id="signatureUpload" accept="image/*">
            <div id="signaturePreview" class="signature-preview">No signature uploaded</div>
        </div>


      <button onclick="submitHodReview()">✅ Submit HOD Approval</button>
      <p id="statusMsg"></p>


     
  <script>
    const queryParams = new URLSearchParams(window.location.search);
    const formId = queryParams.get('formId');


    async function loadDisposalFormData() {
      if (!formId) return alert("Missing form ID!");


      try {
        const res = await fetch(`/api/hod/form-details?formId=${formId}`, {
          credentials: 'include'
        });
        const data = await res.json();


        if (!data.success) return alert("Failed to load form data.");


        const form = data.form.formResponses?.disposalFormData;
        if (!form) return alert("Disposal form data missing.");


        // Fill employee read-only fields
        document.getElementById("unitName").value = form.unitName || '';
        document.getElementById("department").value = form.department || '';
        document.getElementById("emailFrom").value = form.emailFrom || '';
        document.getElementById("designationFrom").value = form.designationFrom || '';
        document.getElementById("empNoFrom").value = form.empNoFrom || '';
        document.getElementById("emailTo").value = form.emailTo || '';
        document.getElementById("designationTo").value = form.designationTo || '';
        document.getElementById("empNoTo").value = form.empNoTo || '';
        document.getElementById("transferDate").value = form.transferDate || '';
        document.getElementById("disposableEmail").value = form.disposableEmail || '';
      } catch (err) {
        console.error('❌ Error loading disposal form:', err);
        alert("Error loading form");
      }
    }


    function previewSignature(event) {
      const file = event.target.files[0];
      if (!file) return;


      const reader = new FileReader();
      reader.onload = function (e) {
        document.getElementById('signaturePreview').innerHTML =
          `<img src="${e.target.result}" alt="Signature" style="max-height: 60px;">`;
      };
      reader.readAsDataURL(file);
    }


    async function submitHodReview() {
      const hodName = document.getElementById("hodName").value.trim();
      const hodEmpNo = document.getElementById("hodEmpNo").value.trim();
      const hodEmail = document.getElementById("hodEmail").value.trim();
      const signatureFile = document.getElementById("signatureUpload").files[0];


      if (!hodName || !hodEmpNo || !hodEmail || !signatureFile) {
        return alert("Please complete all HOD fields and upload signature.");
      }


      const formData = new FormData();
      formData.append('formId', formId);
      formData.append('formType', 'disposal');
      formData.append('hodName', hodName);
      formData.append('hodEmpNo', hodEmpNo);
      formData.append('hodEmail', hodEmail);
      formData.append('signature', signatureFile);


      const res = await fetch('/api/hod/submit-form', {
        method: 'POST',
        credentials: 'include',
        body: formData
      });


      const result = await res.json();
      document.getElementById("statusMsg").textContent = result.message || "Done";
    }


    document.getElementById("signatureUpload").addEventListener("change", previewSignature);
    window.onload = loadDisposalFormData;
  </script>
</body>


</html>